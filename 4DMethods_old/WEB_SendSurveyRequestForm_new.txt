  // WEB_SendSurveyRequestForm( {Year Qtr Pd; Department}  )  // Description:  // Return value:          Process Variables Created:  //  // _____________________________________________________________________________  // Created by : George Michaels on Designer  // Date and time: Friday, May 9, 2014 AD Week: 2/19/Q2 at 11:04:09 a.m. PDT  // _____________________________________________________________________________  // Modification History: (Add "Last Modified" macro lines below.)  // Modified By: George Michaels (05/14/14 - 13:00:12):  Swiched processing to pull in an html file to simplify the processing in tne method to just data that needs to be pulled and formatted.  // _____________________________________________________________________________  // -- Variable declarations --  // If used, $1 = vYearQuarterPeriod ; $2 = $departmentC_TEXT($1;$2;$html;vInstructions;vWEBErrMsg;vDeptTitle;vCurrentQuarter;webSurveyID)C_STRING(6;vYearQuarterPeriod)C_DATE(vDateDue)C_BLOB(bl_SurveyRequestForm)  // The HTML chunk containg the SurveyRequest form upload to the webpage in a <!--#4DHTML--> wrapper  // Get the web request data as usualARRAY TEXT($aWebNames;0)ARRAY TEXT($aWebValues;0)WEB GET VARIABLES($aWebNames;$aWebValues)  // -- Processing logic --  // Step 1. Determine which Department and YearQuarter we are working withIf (Count parameters=1)  // Request From Web servervDepartment:=$aWebValues{Find in array($aWebNames;"department")}vYearQuarterPeriod:=$aWebValues{Find in array($aWebNames;"yq")}Else   // Method called locallyvDepartment:=$2vYearQuarterPeriod:=$1End if   // Step 2. Determine the heading elements - Year Quarter label and (estimated) due date.vCurrentQuarter:=Get_QuarterYearAsString (vYearQuarterPeriod)vDateDue:=SRF_GetDueDate (Substring(vYearQuarterPeriod;1;5))  // Step 3. Determine whether the Department has SubDepartments (different HTML will be needed if so).QUERY([Department];[Department]MainDept=vDepartment)If (Records in selection([Department])=1)vDeptTitle:=[Department]Full_Department_TitleIf ([Department]DeptSubLabelMethod="Manual")$subdepartments:=TrueElse $subdepartments:=FalseEnd if End if   // Step 2. Select the records from the [Survey_Request] table for the departmentQUERY([Survey_Request];[Survey_Request]MainDepartment=vDepartment;*)QUERY([Survey_Request]; & ;[Survey_Request]YrQtrPeriod Key=vYearQuarterPeriod)ORDER BY([Survey_Request];[Survey_Request]Course;>)If (Records in selection([Survey_Request])=0)vWEBErrMsg:="Error: There were no survey request records for Department: <strong>"+vDepartment+"</strong> in "+vYearQuarterPeriod+"."Else FIRST RECORD([Survey_Request])  // Step 3a. First the introductory section with the directions for the formvInstructions:=SRF_GetInstructions ("flex";$subdepartments)  // Step 3b. Construct the HTML blob.   // Create series of <div>+<ul> groups: 1 <div> to contain each Survey_Request record; details in <ul> elements grouped by <div>Repeat webSurveyID:=String([Survey_Request]Survey Number)  // Process var needed for helper methods in this block$html:=$html+"<div class=\"survey_container\">"$html:=$html+WEB_CreateCourseInfo   // HTML in a <div>If (($subdepartments) & ([Survey_Request]Department#"DANCE"))$html:=$html+WEB_CreateESCIDeptSelector2 ([Survey_Request]MainDepartment)  // HTML in a <div>End if $html:=$html+WEB_CreateSTDQChoiceList2 ([Survey_Request]Survey Number)  // HTML in a <div>$html:=$html+"</div>"  // End of courseNEXT RECORD([Survey_Request])Until (End selection([Survey_Request]))  // Step 3c. Elements used to edit course info (via a JS pop-over); normally hidden, and so placed at end of HTML in a separate div.C_TEXT(t_popOver)  // This variable is in a <!--#4DHTML--> wrapper in the static webpaget_popOver:=t_popOver+"<div id=\"popEdit\" class=\"popover\" hidden>"t_popOver:=t_popOver+"<div><ul><li class=\"centered\">Edit Course Details for:</li><li id=\"edit_course\"></li></ul></div>"t_popOver:=t_popOver+"<div><p class=\"centered\">Edit Course Details for:</p><p id=\"edit_course\"></p></div>"t_popOver:=t_popOver+"<hr>"t_popOver:=t_popOver+"<div><ul>"t_popOver:=t_popOver+"<li>Instructor (Last Name &lt;space&gt; First Initial [&lt;space&gt; Middle Initial]:<br>(Must be 2-30 chars. Only letters, spaces, &amp;, and - allowed.)</li>"t_popOver:=t_popOver+"<li>NOTE: If you specify more than one instructor name with &quot;&amp;&quot;, all the instructors will be evaluated under a single Survey.</li>"t_popOver:=t_popOver+"<li><input id=\"edit_instructor\" name=\"edit_instructor\" type=\"text\" maxlength=\"30\" size=\"30\" class=\"mono\" required>"t_popOver:=t_popOver+"<ul id=\"edit_instructor_messages\" class=\"popMessageList\"></ul></li></ul>"t_popOver:=t_popOver+"<ul><li>Rank:</li>"t_popOver:=t_popOver+"<li><select id=\"edit_rank\" name=\"edit_rank\">"+WEB_SRF_GetSelectRank t_popOver:=t_popOver+"</select></li></ul><ul><li>Course Type:</li>"t_popOver:=t_popOver+"<li><select id=\"edit_coursetype\" name=\"edit_coursetype\">"+WEB_SRF_GetSelectCourseType t_popOver:=t_popOver+"</select></li></ul></div>"t_popOver:=t_popOver+"<div><p class=\"centered\"><a id=\"edit_save_changes\" href=\"\">Save Changes</a><br><a id=\"edit_cancel\" href=\"\">Cancel</a></p></div></div>"t_popOver:=t_popOver+"<div id=\"screen\" class=\"screen\"></div>"End if TEXT TO BLOB($html;bl_SurveyRequestForm;UTF8 text without length)  //WEB SEND BLOB(bl_SurveyRequestForm;"text/html")WEB SEND FILE("survey_request/srf_list.shtml")